window.addEventListener('DOMContentLoaded', () => {
  // Access contribution data passed from the template
  const contributionsData = JSON.parse(document.getElementById('contributions-data').textContent);

  // Populate the contributions table
  const contributionsTable = document.querySelector('#contributions-table tbody');

    // Format amount as currency
    contributionDict.amount = contributionDict.amount.toLocaleString('en-KE', {
      style: 'currency',
      currency: 'KES'
    });

    // Format dates
    try {
      contributionDict.contribution_date = new Date(contributionDict.contribution_date).toLocaleDateString();
      contributionDict.contribution_time = new Date(contributionDict.contribution_time).toLocaleTimeString();
    } catch (error) {
      console.error('Error parsing date:', error);
      // Handle the error as needed
    }

    // Create row
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${contributionDict.contribution_reference}</td>
      <td>${contributionDict.contributor_name}</td>
      <td>${contributionDict.amount}</td> 
      <td>${contributionDict.contribution_date}</td>
      <td>${contributionDict.contribution_time}</td>
      <td>${contributionDict.timestamp}</td>
    `;

    // Add row to table
    contributionsTable.appendChild(row);
  });

  // Implement PDF download functionality
  const downloadPdfButton = document.querySelector('#download-pdf');
  downloadPdfButton.addEventListener('click', () => {
    const doc = new jspdf.jspdf();

    // Add header (ensure fundraiser variable is available here)
    doc.setHeader({
      html: `
        <h1>Fundraiser Report</h1>
        <p>Fundraiser: ${fundraiser.name}</p>  <p>Generated on: ${new Date().toLocaleDateString()}</p>
      `
    });

    // Add footer (will be repeated on every page)
    doc.setFooter({
      html: `
        <p>Page ${doc.internal.getNumberOfPages()}</p>
        <p>Generated by https://www.toa.co.ke</p>
      `
    });

    const table = document.querySelector('#contributions-table');
    doc.html(table, {
      callback: (doc) => {
        doc.save('contributions.pdf');
      }
    })});

